# LabelImg Docker 使用指南

## 概述

本项目提供了两个 Docker 脚本来运行 LabelImg 图像标注工具：

1. `run_labelimg_docker.sh` - 图形界面模式（推荐用于桌面环境）
2. `run_labelimg_docker_headless.sh` - 无头模式（适用于服务器环境）

## 系统要求

- Docker 已安装并运行
- 对于图形界面模式：需要 X11 显示环境
- 数据集目录结构正确

## 使用方法

### 1. 图形界面模式（推荐）

```bash
# 在项目根目录运行
bash datasets/run_labelimg_docker.sh
```

**特点：**
- 提供完整的图形用户界面
- 支持鼠标操作和键盘快捷键
- 适用于桌面环境

**注意事项：**
- 确保在图形环境中运行
- 如果遇到 "input device is not a TTY" 错误，请在终端中直接运行
- 需要 X11 转发支持

### 2. 无头模式

```bash
# 在项目根目录运行
bash datasets/run_labelimg_docker_headless.sh
```

**特点：**
- 适用于服务器环境
- 无图形界面依赖
- 适合自动化处理

## 数据集结构

脚本会自动查找以下目录结构：

```
datasets/
└── coco8/
    ├── images/
    │   └── train/          # 训练图像
    └── labels/
        └── train/          # 标注文件
```

## 输出文件

- 标注文件保存在临时目录中
- 脚本结束时会显示临时目录路径
- 需要手动复制标注文件到目标位置

## 故障排除

### 1. Docker 镜像问题

如果遇到镜像拉取失败，脚本已更新为使用 `spiridonovpolytechnic/labelimg` 镜像。

### 2. 权限问题

```bash
# 确保脚本有执行权限
chmod +x datasets/run_labelimg_docker.sh
chmod +x datasets/run_labelimg_docker_headless.sh
```

### 3. X11 显示问题（常见问题）

如果遇到 `Could not connect to any X display` 错误，有以下解决方案：

#### 方案 A：使用 VNC 服务器（推荐）
```bash
# 设置 VNC 服务器
bash datasets/setup_vnc_server.sh

# 连接到 VNC 后运行
export DISPLAY=:1
bash datasets/run_labelimg_docker.sh
```

#### 方案 B：使用虚拟显示
```bash
# 使用虚拟显示运行（无图形界面）
bash datasets/run_labelimg_virtual_display.sh
```

#### 方案 C：使用增强版 Web 标注工具（最佳替代方案）
```bash
# 方法 1：使用启动脚本（推荐）
bash datasets/start_web_annotation.sh

# 方法 2：直接启动
python3 datasets/web_annotation_tool.py

# 在浏览器中访问 http://localhost:8080
```

**增强功能：**
- 📁 智能目录扫描和选择
- 🎯 可视化标注显示和编辑
- 🗑️ 单个/批量标注删除
- 📊 实时统计信息显示
- 📤 标注数据导出功能
- ⌨️ 键盘快捷键支持
- 📱 响应式界面设计

### 4. Docker 服务问题

```bash
# 启动 Docker 服务
sudo systemctl start docker

# 检查 Docker 状态
sudo systemctl status docker
```

## 标注工作流程

1. 运行脚本启动 LabelImg
2. 在图形界面中打开图像文件
3. 使用鼠标绘制边界框
4. 输入类别标签
5. 保存标注文件
6. 复制标注文件到项目目录

## 支持的标注格式

- YOLO 格式（推荐）
- Pascal VOC 格式
- 其他 LabelImg 支持的格式

## 快捷键

- `W` - 创建边界框
- `D` - 下一张图像
- `A` - 上一张图像
- `Del` - 删除选中的边界框
- `Ctrl+S` - 保存标注

## 增强版 Web 标注工具详细功能

### 🎯 核心功能

#### 1. 智能目录管理
- **自动扫描**：自动扫描项目目录，发现所有图像和标签目录
- **目录选择**：通过下拉菜单选择图像和标签目录
- **实时切换**：支持运行时切换不同的数据集目录

#### 2. 可视化标注界面
- **拖拽创建**：在图像上拖拽鼠标创建边界框
- **实时预览**：创建过程中实时显示边界框
- **标注显示**：已保存的标注以红色边界框显示
- **选中状态**：点击标注框可选中，显示蓝色高亮

#### 3. 标注管理功能
- **编辑标注**：点击标注框可编辑类别标签
- **删除单个**：选中标注后点击删除按钮
- **批量删除**：一键删除当前图像的所有标注
- **清除所有**：删除整个数据集的所有标注

#### 4. 统计信息面板
- **总图像数**：显示当前目录中的图像总数
- **已标注数**：显示已完成标注的图像数量
- **总标注数**：显示所有标注框的总数
- **当前进度**：显示当前浏览的图像位置

#### 5. 数据导出功能
- **JSON 导出**：将所有标注数据导出为 JSON 格式
- **批量下载**：支持下载完整的标注数据集
- **格式兼容**：导出的数据兼容 YOLO 训练格式

### ⌨️ 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| `W` | 进入创建边界框模式 |
| `A` | 切换到上一张图像 |
| `D` | 切换到下一张图像 |
| `Del` | 删除当前选中的标注 |
| `Ctrl+S` | 保存当前图像的标注 |

### 🎨 界面特性

- **响应式设计**：支持桌面和移动设备
- **现代 UI**：采用现代化的界面设计
- **实时反馈**：操作结果实时显示
- **错误处理**：友好的错误提示和恢复机制

### 📱 使用流程

1. **启动工具**：运行 `bash datasets/start_web_annotation.sh`
2. **选择目录**：在界面中选择图像和标签目录
3. **加载图像**：点击"加载图像"按钮
4. **开始标注**：在图像上拖拽创建边界框
5. **管理标注**：使用界面按钮或快捷键管理标注
6. **保存数据**：定期保存标注数据
7. **导出结果**：完成标注后导出数据

## 更新日志

- 2024-01-XX: 增强版 Web 标注工具发布
  - 添加智能目录扫描和选择功能
  - 实现可视化标注显示和编辑
  - 支持单个/批量标注删除
  - 添加实时统计信息显示
  - 实现标注数据导出功能
  - 支持键盘快捷键操作
  - 优化响应式界面设计
- 2024-01-XX: 修复 Docker 镜像问题，更新为 `spiridonovpolytechnic/labelimg`
- 2024-01-XX: 添加无头模式支持
- 2024-01-XX: 改进错误处理和用户提示
